<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>台北捷運路線轉盤</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, #f0f0f0, #dcdcdc);
      color: #333;
      flex-direction: column;
    }

    .container {
      text-align: center;
      position: relative;
      width: 500px;
    }

    canvas {
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      display: block;
      margin: 0 auto;
    }

    #pointer {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid #ffcc00;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 8px;
    }

    #result {
      margin-top: 15px;
      font-size: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
<div class="container">
  <div id="pointer"></div>
  <canvas id="wheel" width="500" height="500"></canvas>
  <button id="spin">抽路線</button>
  <div id="result">請選擇路線</div>
</div>

<script>
  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');
  const spinBtn = document.getElementById('spin');
  const result = document.getElementById('result');

  const routeNames = ['淡水信義線', '板南線', '中和新蘆線', '松山新店線', '文湖線'];
  const stationMap = {
    '淡水信義線': ['象山', '信義安和', '大安', '台北車站', '北投', '淡水'],
    '板南線': ['南港展覽館', '市政府', '忠孝敦化', '台北車站', '龍山寺', '板橋', '永寧'],
    '中和新蘆線': ['南勢角', '景安', '古亭', '民權西路', '三重', '蘆洲', '迴龍'],
    '松山新店線': ['新店', '七張', '公館', '中正紀念堂', '松江南京', '南京復興', '松山'],
    '文湖線': ['動物園', '科技大樓', '南京復興', '大直', '劍南路', '南港展覽館']
  };

  const routeColors = {
    '淡水信義線': '#D20000',
    '板南線': '#0070BD',
    '中和新蘆線': '#FFD400',
    '松山新店線': '#008659',
    '文湖線': '#B48C50'
  };

  const neutralColors = ['#e0e0e0', '#d0d0d0', '#c0c0c0', '#b0b0b0', '#a0a0a0'];

  let currentNames = routeNames;
  let currentStage = 'route'; // "route" or "station"

  function drawWheel(names, colors) {
    const num = names.length;
    const angle = (2 * Math.PI) / num;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let i = 0; i < num; i++) {
      ctx.beginPath();
      ctx.moveTo(250, 250);
      ctx.fillStyle = colors[i % colors.length];
      ctx.arc(250, 250, 250, i * angle, (i + 1) * angle);
      ctx.fill();
      ctx.save();

      ctx.translate(250, 250);
      ctx.rotate(i * angle + angle / 2);
      ctx.textAlign = "right";
      ctx.fillStyle = '#000';
      ctx.font = "16px sans-serif";
      ctx.fillText(names[i], 230, 10);
      ctx.restore();
    }
  }

  drawWheel(routeNames, neutralColors);

  function spinWheel() {
    const num = currentNames.length;
    const anglePerSlice = 360 / num;
    const spinAngle = Math.floor(Math.random() * 360) + 360 * 5;
    const selectedIndex = Math.floor(((360 - (spinAngle % 360)) % 360) / anglePerSlice);

    let rotation = 0;
    const interval = setInterval(() => {
      rotation += 10;
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.translate(250, 250);
      ctx.rotate(rotation * Math.PI / 180);
      ctx.translate(-250, -250);
      drawWheel(currentNames, currentStage === 'route' ? neutralColors : [routeColors[result.innerText]]);
    }, 16);

    setTimeout(() => {
      clearInterval(interval);
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      const selected = currentNames[selectedIndex];
      result.innerText = currentStage === 'route' ? `本次抽到：${selected}` : `抽到站：${selected}`;
      spinBtn.innerText = currentStage === 'route' ? '抽站名' : '抽路線';

      if (currentStage === 'route') {
        currentStage = 'station';
        currentNames = stationMap[selected];
        drawWheel(currentNames, [routeColors[selected]]);
      } else {
        // 回到抽路線階段（5 秒後）
        setTimeout(() => {
          currentStage = 'route';
          currentNames = routeNames;
          drawWheel(currentNames, neutralColors);
          result.innerText = '請選擇路線';
          spinBtn.innerText = '抽路線';
        }, 5000);
      }
    }, 3000);
  }

  spinBtn.addEventListener('click', spinWheel);
</script>
</body>
</html>
